document.addEventListener("DOMContentLoaded",(function(){let e=[],n=[],t=[],s=[],l=[];function a(e){return testBank.find((n=>n.id===e))}function i(n){const t=e[n],s=Math.floor(Math.random()*t.length),l=t[s],i=l[Math.floor(Math.random()*l.length)],o={id:0,question:"",answer:[],solution:""};let r=[];r.push(...l),t.splice(s,1);let d=t[Math.floor(Math.random()*t.length)];for(;r.length<4;){const e=d[Math.floor(Math.random()*d.length)];r.includes(e)||r.push(e)}r=function(e){for(let n=e.length-1;n>0;n--){const t=Math.floor(Math.random()*(n+1));[e[n],e[t]]=[e[t],e[n]]}return e}(r);let u=a(i);return o.id=u.id,o.question=u.img,o.solution=u.name,r.forEach((e=>{let n=a(e);o.answer.push({id:n.id,name:n.name,img:n.img})})),o}document.querySelector("#newQuiz").addEventListener("click",(a=>{let o=document.querySelector(".quiz"),r=0;e=structuredClone(mapping),document.querySelector(".control").classList.remove("show"),newTestBank=JSON.parse(JSON.stringify(testBank)),n=[],t=[],s=[],l=[],o.innerHTML="";for(let e=0;e<9;e++){let e=i("rhizomes");n.push(e)}for(let e=0;e<2;e++){let e=i("wholeHerbs");n.push(e)}for(let e=0;e<2;e++){let e=i("fruitsAndSeeds");n.push(e)}for(let e=0;e<3;e++){let e=i("others");n.push(e)}n.forEach((function(e){let n=document.createElement("div");n.classList.add("test","text"),n.innerHTML="<h2>第"+(r+1)+'題</h2>\n<div class="col">\n<div class="question">\n<img src="'+e.question+'">\n</div>\n<div class="answer">\n<div class="options">\n<input type="radio" name="test'+r+'" id="'+r+'-0" value="'+e.answer[0].id+'">\n<label for="'+r+'-0">'+e.answer[0].name+'</label>\n</div>\n<div class="options">\n<input type="radio" name="test'+r+'" id="'+r+'-1" value="'+e.answer[1].id+'">\n<label for="'+r+'-1">'+e.answer[1].name+'</label>\n</div>\n<div class="options">\n<input type="radio" name="test'+r+'" id="'+r+'-2" value="'+e.answer[2].id+'">\n<label for="'+r+'-2">'+e.answer[2].name+'</label>\n</div>\n<div class="options">\n<input type="radio" name="test'+r+'" id="'+r+'-3" value="'+e.answer[3].id+'">\n<label for="'+r+'-3">'+e.answer[3].name+'</label>\n</div>\n<p>正確答案： <span class="solution"></span></p>\n</div>\n</div>',r++,o.appendChild(n)}));for(let e=0;e<4;e++){let e=i("rhizomes");t.push(e)}for(let e=0;e<1;e++){let e=i("wholeHerbs");t.push(e)}for(let e=0;e<2;e++){let e=i("fruitsAndSeeds");t.push(e)}for(let e=0;e<2;e++){let e=i("others");t.push(e)}t.forEach((function(e){let n=document.createElement("div");n.classList.add("test","picture"),n.innerHTML="\n      <h2>第"+(r+1)+"題</h2>\n          <p>下列圖片何者是"+e.solution+'？</p>\n          <div class="answer pictures">\n            <div class="options">\n              <label for="'+r+'-0">\n                <img src="'+e.answer[0].img+'">\n              </label>\n              <span class="solution" data-value="'+e.answer[0].id+'"></span>\n              <input type="radio" name="test'+r+'" id="'+r+'-0" value="'+e.answer[0].id+'">\n            </div>\n            <div class="options">\n              <label for="'+r+'-1">\n                <img src="'+e.answer[1].img+'">\n              </label>\n              <span class="solution" data-value="'+e.answer[1].id+'"></span>\n              <input type="radio" name="test'+r+'" id="'+r+'-1" value="'+e.answer[1].id+'">\n            </div>\n            <div class="options">\n              <label for="'+r+'-2">\n                <img src="'+e.answer[2].img+'">\n              </label>\n              <span class="solution" data-value="'+e.answer[2].id+'"></span>\n              <input type="radio" name="test'+r+'" id="'+r+'-2" value="'+e.answer[2].id+'">\n            </div>\n            <div class="options">\n              <label for="'+r+'-3">\n                <img src="'+e.answer[3].img+'">\n              </label>\n              <span class="solution" data-value="'+e.answer[3].id+'"></span>\n              <input type="radio" name="test'+r+'" id="'+r+'-3" value="'+e.answer[3].id+'">\n            </div>\n          </div>\n      ',r++,o.appendChild(n)}))})),document.querySelector("#send").addEventListener("click",(e=>{let i=document.querySelectorAll(".test.text"),o=document.querySelectorAll(".test.picture"),r=0;document.querySelector(".control").classList.add("show"),i.forEach((e=>{let n=0,t=e.querySelectorAll("input");e.querySelector("p").setAttribute("class","show");for(let e=0;e<4;e++){if(n++,t[e].checked){s.push(parseInt(t[e].value,10));break}4===n&&s.push(9999)}}));for(let e=0;e<16;e++)i[e].querySelector(".solution").innerHTML=n[e].solution,s[e]===n[e].id?r+=4:i[e].querySelector(".solution").classList.add("wrong");o.forEach((e=>{let n=0,t=e.querySelectorAll("input");for(let e=0;e<4;e++){if(n++,t[e].checked){l.push(parseInt(t[e].value,10));break}4===n&&l.push(9999)}}));for(let e=0;e<9;e++){o[e].querySelectorAll(".solution").forEach((function(n){let s=n.getAttribute("data-value"),l=a(parseInt(s));parseInt(s)!==t[e].id&&n.classList.add("wrong"),n.innerHTML=l.name})),l[e]===t[e].id&&(r+=4)}document.querySelector(".num").innerHTML=r,window.scrollTo(0,0)})),document.querySelector("#newQuiz").click()}));