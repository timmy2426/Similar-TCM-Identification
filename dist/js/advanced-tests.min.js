document.addEventListener("DOMContentLoaded",(function(){let e=[],n=[],t=[];function o(e){return testBank.find((n=>n.id===e))}function l(n){const t=e[n],l=Math.floor(Math.random()*t.length),s=t[l],r=s[Math.floor(Math.random()*s.length)],i={id:0,question:"",answer:[],solution:""};let a=[];a.push(...s),t.splice(l,1);let d=t[Math.floor(Math.random()*t.length)];for(;a.length<4;){const e=d[Math.floor(Math.random()*d.length)];a.includes(e)||a.push(e)}a=function(e){for(let n=e.length-1;n>0;n--){const t=Math.floor(Math.random()*(n+1));[e[n],e[t]]=[e[t],e[n]]}return e}(a);let u=o(r);return i.id=u.id,i.question=u.img,i.solution=u.name,a.forEach((e=>{let n=o(e);i.answer.push({id:n.id,name:n.name})})),i}document.querySelector("#newQuiz").addEventListener("click",(o=>{let s=document.querySelector(".quiz"),r=0;e=structuredClone(mapping),document.querySelector(".control").classList.remove("show"),newTestBank=JSON.parse(JSON.stringify(testBank)),n=[],t=[],s.innerHTML="";for(let e=0;e<13;e++){let e=l("rhizomes");n.push(e)}for(let e=0;e<3;e++){let e=l("wholeHerbs");n.push(e)}for(let e=0;e<4;e++){let e=l("fruitsAndSeeds");n.push(e)}for(let e=0;e<5;e++){let e=l("others");n.push(e)}n.forEach((function(e){let n=document.createElement("div");n.setAttribute("class","test"),n.innerHTML="<h2>第"+(r+1)+'題</h2>\n<div class="col">\n<div class="question">\n<img src="'+e.question+'">\n</div>\n<div class="answer">\n<div class="options">\n<input type="radio" name="test'+r+'" id="'+r+'-0" value="'+e.answer[0].id+'">\n<label for="'+r+'-0">'+e.answer[0].name+'</label>\n</div>\n<div class="options">\n<input type="radio" name="test'+r+'" id="'+r+'-1" value="'+e.answer[1].id+'">\n<label for="'+r+'-1">'+e.answer[1].name+'</label>\n</div>\n<div class="options">\n<input type="radio" name="test'+r+'" id="'+r+'-2" value="'+e.answer[2].id+'">\n<label for="'+r+'-2">'+e.answer[2].name+'</label>\n</div>\n<div class="options">\n<input type="radio" name="test'+r+'" id="'+r+'-3" value="'+e.answer[3].id+'">\n<label for="'+r+'-3">'+e.answer[3].name+'</label>\n</div>\n<p>正確答案： <span class="solution"></span></p>\n</div>\n</div>',r++,s.appendChild(n)}))})),document.querySelector("#send").addEventListener("click",(e=>{let o=document.querySelectorAll(".test"),l=0;t=[],document.querySelector(".control").classList.add("show"),o.forEach((e=>{let n=0,o=e.querySelectorAll("input");e.querySelector("p").setAttribute("class","show");for(let e=0;e<4;e++){if(n++,o[e].checked){t.push(parseInt(o[e].value,10));break}4===n&&t.push(9999)}}));for(let e=0;e<25;e++)o[e].querySelector(".solution").innerHTML=n[e].solution,t[e]===n[e].id?l+=4:o[e].querySelector(".solution").classList.add("wrong");document.querySelector(".num").innerHTML=l,window.scrollTo(0,0)})),document.querySelector("#newQuiz").click()}));